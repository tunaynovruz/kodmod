---
title: Spring JdbcTemplate
sidebar_label: JdbcTemplate
description: Spring JdbcTemplate ilə SQL icrası, RowMapper, NamedParameterJdbcTemplate, Batch və Transaction idarəetməsi
slug: spring/jdbctemplate
tags: [spring, jdbc, database, sql, jdbctemplate]
keywords: [spring jdbctemplate, rowmapper, namedparameterjdbctemplate, batch update, transaction]
hide_table_of_contents: false
---

# Spring JdbcTemplate

`JdbcTemplate` Spring-in sadələşdirilmiş JDBC abstraction qatıdır. Məqsəd: repetitiv kodu (Connection, PreparedStatement, ResultSet idarəsi) aradan qaldırmaq, exception translation təmin etmək və daha oxunaqlı data akses qatına nail olmaq.

## Əsas Üstünlüklər
- Boilerplate kodun azalması
- `DataAccessException` hierarxiyası ilə vahid exception modeli
- Resource leak riskinin azaldılması (try-with-resources avtomatlaşdırılır)
- Parametrli sorğuların təhlükəsiz (SQL injection riskini azaldır) icrası
- Batch əməliyyatlara dəstək

## Bean Konfiqurasiyası
Əksər hallarda Spring Boot `DataSource` və `JdbcTemplate`-i avtomatik yaradır. Lazım olsa manual tərif:
<details>
<summary>Koda bax</summary>

```java
@Configuration
public class DataConfig {
    @Bean
    public DataSource dataSource(){
        HikariDataSource ds = new HikariDataSource();
        ds.setJdbcUrl("jdbc:postgresql://localhost:5432/app");
        ds.setUsername("app");
        ds.setPassword("secret");
        return ds;
    }

    @Bean
    public JdbcTemplate jdbcTemplate(DataSource ds){
        return new JdbcTemplate(ds);
    }
}
```
</details>

## Sadə SELECT
<details>
<summary>Koda bax</summary>

```java
@Service
public class UserRepository {
    private final JdbcTemplate jdbc;

    public UserRepository(JdbcTemplate jdbc) { this.jdbc = jdbc; }

    public int countUsers() {
        return jdbc.queryForObject("SELECT COUNT(*) FROM users", Integer.class);
    }
}
```
</details>

## Parametrli Sorğular
<details>
<summary>Koda bax</summary>

```java
public User findById(Long id){
    return jdbc.queryForObject(
        "SELECT id, username, email FROM users WHERE id = ?",
        (rs, rowNum) -> new User(
            rs.getLong("id"),
            rs.getString("username"),
            rs.getString("email")
        ),
        id
    );
}
```
</details>

## RowMapper İstifadəsi
<details>
<summary>Koda bax</summary>

```java
class UserRowMapper implements RowMapper<User> {
    @Override
    public User mapRow(ResultSet rs, int rowNum) throws SQLException {
        return new User(
            rs.getLong("id"),
            rs.getString("username"),
            rs.getString("email")
        );
    }
}

public List<User> findAll(){
    return jdbc.query("SELECT id, username, email FROM users", new UserRowMapper());
}
```
</details>

## Lambdalar ilə qısa RowMapper
<details>
<summary>Koda bax</summary>

```java
public List<String> usernames(){
    return jdbc.query(
        "SELECT username FROM users",
        (rs, row) -> rs.getString(1)
    );
}
```
</details>

## `queryForObject` vs `query`
| Metod | Nəticə | Qeyd |
|-------|--------|------|
| queryForObject | Tək dəyər və ya tək row | Nəticə 0 və ya >1 olarsa exception |
| query | List (0..N) | Flexible |

## Insert / Update / Delete
<details>
<summary>Koda bax</summary>

```java
public int updateEmail(Long id, String email){
    return jdbc.update("UPDATE users SET email=? WHERE id=?", email, id);
}

public int deleteById(Long id){
    return jdbc.update("DELETE FROM users WHERE id=?", id);
}
```
</details>

## Auto-Generated ID (KeyHolder)
<details>
<summary>Koda bax</summary>

```java
public Long insert(User u){
    KeyHolder kh = new GeneratedKeyHolder();
    jdbc.update(con -> {
        PreparedStatement ps = con.prepareStatement(
            "INSERT INTO users(username,email) VALUES(?,?)",
            Statement.RETURN_GENERATED_KEYS
        );
        ps.setString(1, u.username());
        ps.setString(2, u.email());
        return ps;
    }, kh);
    return kh.getKey().longValue();
}
```
</details>

## NamedParameterJdbcTemplate
Placeholder-ları daha oxunaqlı edir.
<details>
<summary>Koda bax</summary>

```java
@Repository
public class OrderRepository {
    private final NamedParameterJdbcTemplate named;

    public OrderRepository(DataSource ds){
        this.named = new NamedParameterJdbcTemplate(ds);
    }

    public List<Order> findByStatus(String status){
        String sql = "SELECT id, status, total FROM orders WHERE status=:st";
        Map<String,Object> params = Map.of("st", status);
        return named.query(sql, params, (rs, i) -> new Order(
            rs.getLong("id"), rs.getString("status"), rs.getBigDecimal("total")
        ));
    }
}
```
</details>

## Batch Əməliyyatlar
Çox sayda update/insert üçün performans.
<details>
<summary>Koda bax</summary>

```java
public int[] batchInsert(List<User> users){
    return jdbc.batchUpdate(
        "INSERT INTO users(username,email) VALUES(?,?)",
        new BatchPreparedStatementSetter() {
            public void setValues(PreparedStatement ps, int i) throws SQLException {
                User u = users.get(i);
                ps.setString(1, u.username());
                ps.setString(2, u.email());
            }
            public int getBatchSize(){ return users.size(); }
        }
    );
}
```
</details>

## Transaction İdarəetməsi
`@Transactional` ilə çox SQL əməliyyatı vahid atomic blok kimi.
<details>
<summary>Koda bax</summary>

```java
@Service
public class TransferService {
    private final JdbcTemplate jdbc;
    public TransferService(JdbcTemplate jdbc){ this.jdbc = jdbc; }

    @Transactional
    public void transfer(long from, long to, BigDecimal amount){
        jdbc.update("UPDATE account SET balance = balance - ? WHERE id=?", amount, from);
        // Mümkün xəta sınağı üçün: if(true) throw new RuntimeException();
        jdbc.update("UPDATE account SET balance = balance + ? WHERE id=?", amount, to);
    }
}
```
</details>

## Exception Translation
Altda yatan SQL xətaları `DataAccessException` növlərinə translate olunur. Misal: `DuplicateKeyException`, `EmptyResultDataAccessException`.

## Performance Məzmunu
- Batch istifadə et (network roundtrip azalır)
- Select * yerinə konkret sütunlar
- RowMapper-ləri reuse et
- HikariCP connection pool default kifayət qədər optimallaşdırılıb

## Nə Zaman JPA əvəzinə JdbcTemplate?
| Ssenari | JdbcTemplate | JPA |
|---------|--------------|-----|
| Sadə CRUD + yüksək performans | ✅ | ⚠️ Overhead |
| Kompleks obyekt qrafı | ⚠️ Manual mapping çətin | ✅ |
| Tam nəzarət (custom SQL) | ✅ | ⚠️ |
| Sürətli prototipləmə | ⚠️ Daha çox kod | ✅ |

## Tez Sual-Cavab
| Sual | Cavab |
|------|-------|
| query null qaytara bilər? | Boş list (null yox) |
| queryForObject tapmasa? | `EmptyResultDataAccessException` |
| Transactions necə? | PlatformTransactionManager + @Transactional |
| SQL injection qorunması? | PreparedStatement parametrləri |

## Növbəti Addım
Entity idarəetməsi və daha geniş data inteqrasiyası üçün: `spring/main-annotations` və security üçün `spring/security` sənədlərinə bax.
