---
title: Content Security Policy (CSP)
sidebar_label: CSP
description: Content Security Policy təhlükəsizlik başlıqları və tətbiq edilməsi
slug: security/csp
tags: [csp, security, web-security, headers, xss-prevention]
keywords: [csp, content security policy, təhlükəsizlik başlıqları, xss, web təhlükəsizliyi]
hide_table_of_contents: false
---

# Content Security Policy (CSP)

- **Content Security Policy:** Veb səhifələrinin hansı mənbələrdən resurs yükləyə biləcəyini müəyyən edən təhlükəsizlik mexanizmi.
- **XSS Müdafiəsi:** CSP-nin əsas məqsədi Cross-Site Scripting (XSS) hücumlarının qarşısını almaqdır.
- **Directive Əsaslı:** Müxtəlif növ resurslar üçün (script, style, image, və s.) ayrı-ayrı qaydalar müəyyən edir.
- **Report-Only Mode:** İlk öncə monitor rejimində işləyir, sonra enforce edilir.
- **Nonce və Hash:** Script və style-lar üçün təsadüfi nonce və ya hash dəyərləri istifadə edir.

## Əsas Anlayışlar

### CSP Directive-ləri

- **default-src:** Bütün resurs növləri üçün standart qaydalar
- **script-src:** JavaScript faylları üçün mənbə qaydaları
- **style-src:** CSS faylları üçün mənbə qaydaları
- **img-src:** Şəkillər üçün mənbə qaydaları
- **connect-src:** AJAX, WebSocket, və EventSource üçün qaydalar
- **font-src:** Şriftlər üçün mənbə qaydaları
- **object-src:** Plugin-lər üçün qaydalar
- **media-src:** Audio və video üçün qaydalar
- **child-src:** iframe və worker-lər üçün qaydalar

### CSP Source Keyword-ləri

| Keyword       | Təsvir | Nümunə |
|---------------|---------|---------|
| 'self'        | Eyni origin | script-src 'self' |
| 'none'        | Heç bir mənbə | object-src 'none' |
| 'unsafe-inline' | Inline kod icazəsi | style-src 'unsafe-inline' |
| 'unsafe-eval' | eval() icazəsi | script-src 'unsafe-eval' |
| 'strict-dynamic' | Nonce/hash ilə yüklənən script-lərin digər script-ləri yükləməsinə icazə | script-src 'strict-dynamic' |
| 'nonce-value ' | Təsadüfi nonce dəyəri | script-src 'nonce-abc123' |
| 'sha256-hash' | SHA256 hash dəyəri | script-src 'sha256-xyz789' |

## CSP Tətbiq Metodları

### HTTP Header

```http
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'
```

### HTML Meta Tag

```html
<meta http-equiv="Content-Security-Policy" 
      content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
```

### Report-Only Mode

```http
Content-Security-Policy-Report-Only: default-src 'self'; report-uri /csp-violation-report-endpoint/
```

## Praktik Nümunələr

### Əsas CSP Policy

```http
Content-Security-Policy: 
    default-src 'self';
    script-src 'self' https://apis.google.com;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    img-src 'self' data: https:;
    font-src 'self' https://fonts.gstatic.com;
    connect-src 'self' https://api.example.com;
    frame-src 'none';
    object-src 'none';
    base-uri 'self';
    form-action 'self';
```

### React Tətbiqi üçün CSP

```http
Content-Security-Policy: 
    default-src 'self';
    script-src 'self' 'sha256-{webpack-runtime-hash}';
    style-src 'self' 'unsafe-inline';
    img-src 'self' data: https:;
    font-src 'self' https://fonts.gstatic.com;
    connect-src 'self' https://api.example.com;
    frame-ancestors 'none';
```

### Spring Boot-da CSP

```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.headers(headers -> 
            headers.contentSecurityPolicy(
                "default-src 'self'; " +
                "script-src 'self' 'nonce-{nonce}'; " +
                "style-src 'self' 'unsafe-inline'"
            )
        );
        return http.build();
    }
}
```

## CSP Reporting

### Violation Report Structure

```json
{
  "csp-report": {
    "document-uri": "https://example.com/page",
    "referrer": "https://example.com/",
    "violated-directive": "script-src 'self'",
    "effective-directive": "script-src",
    "original-policy": "default-src 'self'; script-src 'self'",
    "disposition": "enforce",
    "blocked-uri": "https://malicious.com/script.js",
    "status-code": 200,
    "script-sample": "console.log('blocked')"
  }
}
```

### Report Endpoint

```java
@RestController
public class CSPReportController {
    
    @PostMapping("/csp-violation-report")
    public ResponseEntity<Void> handleCSPViolation(@RequestBody String report) {
        // Log və analiz et
        logger.warn("CSP Violation: {}", report);
        return ResponseEntity.ok().build();
    }
}
```

## Ümumi Problemlər və Həllər

### 1. Inline Script Problemi

**Problem:** Inline script-lər bloklanır
```javascript
// Bloklanacaq
<script>console.log('hello');</script>
```

**Həll:** Nonce istifadə et
```html
<script nonce="abc123">console.log('hello');</script>
```

### 2. Third-party Widget Problemi

**Problem:** External widget-lər işləmir
```http
# Çox məhdudlaşdırıcı
script-src 'self'
```

**Həll:** Lazımi domainləri əlavə et
```http
script-src 'self' https://widgets.example.com
```

### 3. Development vs Production

**Development:**
```http
Content-Security-Policy-Report-Only: 
    default-src 'self' 'unsafe-inline' 'unsafe-eval';
    report-uri /csp-report
```

**Production:**
```http
Content-Security-Policy: 
    default-src 'self';
    script-src 'self' 'nonce-{random}';
    style-src 'self';
```

## Best Practice-lər

### 1. Tədricən Tətbiq Et
1. Report-only mode ilə başla
2. Violation report-larını analiz et
3. Policy-ni tədricən sərtləşdir
4. Enforce mode-a keç

### 2. Nonce Generasiyası
```java
// Hər request üçün yeni nonce
String nonce = UUID.randomUUID().toString();
response.setHeader("Content-Security-Policy", 
    "script-src 'self' 'nonce-" + nonce + "'");
```

### 3. CSP Testing
```javascript
// CSP test script
if ('securitypolicyviolation' in document) {
    document.addEventListener('securitypolicyviolation', function(e) {
        console.log('CSP Violation:', e.violatedDirective, e.blockedURI);
    });
}
```

## CSP Monitoring

### Google Analytics Integration
```javascript
document.addEventListener('securitypolicyviolation', function(e) {
    gtag('event', 'csp_violation', {
        'violated_directive': e.violatedDirective,
        'blocked_uri': e.blockedURI,
        'document_uri': e.documentURI
    });
});
```

CSP veb təhlükəsizliyində əsas rol oynayır və düzgün tətbiq edildikdə XSS hücumlarının əksəriyyətini qarşısını alır.
